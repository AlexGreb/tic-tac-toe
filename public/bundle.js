(()=>{"use strict";var e={187:e=>{var t,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,s){function i(n){e.removeListener(t,o),s(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}b(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&b(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function r(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,s){var i,o,a,c;if(r(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=s?[n,a]:[a,n]:s?a.unshift(n):a.push(n),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=a.length,c=h,console&&console.warn&&console.warn(c)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(s);return i.listener=n,s.wrapFn=i,i}function m(e,t,n){var s=e._events;if(void 0===s)return[];var i=s[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function u(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function b(e,t,n,s){if("function"==typeof e.on)s.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){s.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var r=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw r.context=a,r}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)s(l,this,t);else{var c=l.length,h=g(l,c);for(n=0;n<c;++n)s(h[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return r(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return r(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,s,i,o,a;if(r(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,s;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(s=0;s<o.length;++s)"removeListener"!==(i=o[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},o.prototype.listeners=function(e){return m(this,e,!0)},o.prototype.rawListeners=function(e){return m(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):u.call(e,t)},o.prototype.listenerCount=u,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=(e,t)=>{const n=document.createElement("div");return t&&n.classList.add(t),n.insertAdjacentHTML("afterbegin",e.trim()),n.children[0]},t=class{constructor(){this.events={}}emit(e,t){const n=this.events[e];n&&n.forEach((e=>{e.call(null,t)}))}subscribe(e,t){if(null!=t)return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.events[e]=this.events[e].filter((e=>t!==e))}}};class s extends t{constructor(){if(super(),new.target===s)throw new Error("Can't instantiate AbstractView, only concrete one")}get template(){throw new Error("Template is required")}get element(){return this._element||(this._element=this.render(),this.bind(this._element),this.postRender(this._element)),this._element}render(){return e(this.template,this.className)}bind(){}postRender(){}}const i=s;class o{#e=null;constructor(e,t=80,n=80){this.status=e,this.width=t,this.height=n}get element(){return null!=this.#e?this.#e:(this.#e=e(this.template,"loader"),this.element)}get template(){return`<svg xmlns="http://www.w3.org/2000/svg" \n                width="${this.width}"\n                height="${this.height}"\n                viewBox="0 0 100 100">\n                <path fill="#fff" \n                      d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">\n                <animateTransform \n                    attributeName="transform" \n                    attributeType="XML" \n                    type="rotate"\n                    dur="1s" \n                    from="0 50 50"\n                    to="360 50 50" \n                    repeatCount="indefinite" />\n                    <animate attributeName="fill" \n                             values="#ff0000;#ff7300;#fffb00; #48ff00; #00ffd5; #002bff; #7a00ff; #ff00c8; #b16161" \n                             dur="3s" \n                             repeatCount="indefinite" />\n                </path>\n                ${null!=this.status?this.statusText:""}\n            </svg>`}changeStatus(e){const t=this.#e.querySelector(".loader__text");if(t)t.nodeValue=e;else{const t=document.createElement("div");t.classList.add("loader__text"),t.nodeValue=e,this.#e.appendChild(t)}}get statusText(){return`<div class="loader__text">${this.status}</div>`}}var a=n(187),r=n.n(a);let l=null;const c=Object.freeze({el:null,animate:!0,animateClass:"fade",animateInClass:"show",appendTo:"body",backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),h=function e(t){for(let n in t)Array.isArray(t[n])?t[n].forEach((t=>{e(t)})):null!==t[n]&&"object"==typeof t[n]&&Object.freeze(t[n]);return Object.freeze(t)}({dialog:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}],alert:[{text:"OK",attr:{class:"btn btn-primary","data-dismiss":"modal"}}],confirm:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}),d={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function m(e,t,n){let s=e.data||{};if(void 0===n){if(e.data&&e.data[t])return e.data[t];var i=e.getAttribute(`data-${t}`);return void 0!==i?i:null}return s[t]=n,e.data=s,e}function u(e,t){return e.nodeName?e:(e=e.replace(/(\t|\n$)/g,""),l||(l=document.createElement("div")),l.innerHTML="",l.innerHTML=e,!0===t?l.childNodes:l.childNodes[0])}function g(e){let t=[e];for(;e.parentNode;)e=e.parentNode,t.push(e);return t}class b extends(r()){static set templates(e){this._baseTemplates=e}static get templates(){return Object.assign({},d,b._baseTemplates||{})}static set buttons(e){this._baseButtons=e}static get buttons(){return Object.assign({},h,b._baseButtons||{})}static set options(e){this._baseOptions=e}static get options(){return Object.assign({},c,b._baseOptions||{})}static get version(){return"0.12.0"}static alert(e,t={}){let n=Object.assign({},c,{title:e,content:!1,construct:!0,headerClose:!1,buttons:b.buttons.alert},t);return new b(n)}static confirm(e,t={}){let n=Object.assign({},c,{title:e,content:!1,construct:!0,headerClose:!1,buttons:b.buttons.confirm},t);return new b(n)}constructor(e={}){if(super(),this.id=(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16),this.el=null,this._html={},this._events={},this._visible=!1,this._pointerInContent=!1,this._options=Object.assign({},b.options,e),this._templates=Object.assign({},b.templates,e.templates||{}),this._html.appendTo=document.querySelector(this._options.appendTo),this._scrollbarWidth=function(){let e,t,n,s=document.createElement("div");return Object.assign(s.style,{visibility:"hidden",width:"100px"}),document.body.appendChild(s),n=s.offsetWidth,s.style.overflow="scroll",e=document.createElement("div"),e.style.width="100%",s.appendChild(e),t=n-e.offsetWidth,document.body.removeChild(s),t}(),null===this._options.buttons&&(this._options.buttons=b.buttons.dialog),this._options.el){let e=this._options.el;if("string"==typeof this._options.el&&(e=document.querySelector(this._options.el),!e))throw new Error(`Selector: DOM Element ${this._options.el} not found.`);m(e,"modal",this),this.el=e}else this._options.construct=!0;this._options.construct?this._render():this._mapDom()}_render(){let e=this._html,t=this._options,n=this._templates,s=!!t.animate&&t.animateClass;return e.container=u(n.container),e.dialog=u(n.dialog),e.content=u(n.content),e.header=u(n.header),e.headerClose=u(n.headerClose),e.body=u(n.body),e.footer=u(n.footer),s&&e.container.classList.add(s),this._setHeader(),this._setContent(),this._setFooter(),this.el=e.container,e.dialog.appendChild(e.content),e.container.appendChild(e.dialog),this}_mapDom(){let e=this._html,t=this._options;return this.el.classList.contains(t.animateClass)&&(t.animate=!0),e.container=this.el,e.dialog=this.el.querySelector(".modal-dialog"),e.content=this.el.querySelector(".modal-content"),e.header=this.el.querySelector(".modal-header"),e.headerClose=this.el.querySelector(".modal-header .close"),e.body=this.el.querySelector(".modal-body"),e.footer=this.el.querySelector(".modal-footer"),this._setHeader(),this._setContent(),this._setFooter(),this}_setHeader(){let e=this._html,t=this._options;t.header&&e.header&&(t.title.nodeName?e.header.innerHTML=t.title.outerHTML:"string"==typeof t.title&&(e.header.innerHTML=`<h4 class="modal-title">${t.title}</h4>`),null===this.el&&e.headerClose&&t.headerClose&&e.header.appendChild(e.headerClose),t.construct&&e.content.appendChild(e.header))}_setContent(){let e=this._html,t=this._options;t.content&&e.body&&("string"==typeof t.content?e.body.innerHTML=t.content:e.body.innerHTML=t.content.outerHTML,t.construct&&e.content.appendChild(e.body))}_setFooter(){let e=this._html,t=this._options;t.footer&&e.footer&&(t.footer.nodeName?e.footer.ineerHTML=t.footer.outerHTML:"string"==typeof t.footer?e.footer.innerHTML=t.footer:e.footer.children.length||t.buttons.forEach((t=>{let n=document.createElement("button");m(n,"button",t),n.innerHTML=t.text,n.setAttribute("type","button");for(let e in t.attr)n.setAttribute(e,t.attr[e]);e.footer.appendChild(n)})),t.construct&&e.content.appendChild(e.footer))}_setEvents(){this._options;let e=this._html;this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener("keydown",this._events.keydownHandler),this._events.mousedownHandler=this._handleMousedownEvent.bind(this),e.container.addEventListener("mousedown",this._events.mousedownHandler),this._events.clickHandler=this._handleClickEvent.bind(this),e.container.addEventListener("click",this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener("resize",this._events.resizeHandler)}_handleMousedownEvent(e){this._pointerInContent=!1,g(e.target).every((e=>!e.classList||!e.classList.contains("modal-content")||(this._pointerInContent=!0,!1)))}_handleClickEvent(e){g(e.target).every((t=>!("HTML"===t.tagName||!0!==this._options.backdrop&&t.classList.contains("modal")||t.classList.contains("modal-content")||("modal"===t.getAttribute("data-dismiss")?(this.emit("dismiss",this,e,m(e.target,"button")),this.hide(),1):!this._pointerInContent&&t.classList.contains("modal")&&(this.emit("dismiss",this,e,null),this.hide(),1))))),this._pointerInContent=!1}_handleKeydownEvent(e){27===e.which&&this._options.keyboard&&(this.emit("dismiss",this,e,null),this.hide())}_handleResizeEvent(e){this._resize()}show(){let e=this._options,t=this._html;return this.emit("show",this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add("modal-open"),e.construct&&t.appendTo.appendChild(t.container),t.container.style.display="block",t.container.scrollTop=0,!1!==e.backdrop?(this.once("showBackdrop",(()=>{this._setEvents(),e.animate&&t.container.offsetWidth,t.container.classList.add(e.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),e.transition)})),this._backdrop()):(this._setEvents(),e.animate&&t.container.offsetWidth,t.container.classList.add(e.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),e.transition)),this._resize(),this}toggle(){this._visible?this.hide():this.show()}_resize(){var e=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&e?this._scrollbarWidth+"px":"",this._html.container.style.paddingRight=this.bodyIsOverflowing&&!e?this._scrollbarWidth+"px":""}_backdrop(){let e=this._html,t=this._templates,n=this._options,s=!!n.animate&&n.animateClass;e.backdrop=u(t.backdrop),s&&e.backdrop.classList.add(s),e.appendTo.appendChild(e.backdrop),s&&e.backdrop.offsetWidth,e.backdrop.classList.add(n.animateInClass),setTimeout((()=>{this.emit("showBackdrop",this)}),this._options.backdropTransition)}hide(){let e=this._html,t=this._options,n=e.container.classList;return this.emit("hide",this),n.remove(t.animateInClass),t.backdrop&&e.backdrop.classList.remove(t.animateInClass),this._removeEvents(),setTimeout((()=>{document.body.classList.remove("modal-open"),document.body.style.paddingRight=this.originalBodyPad}),t.backdropTransition),setTimeout((()=>{t.backdrop&&e.backdrop.parentNode.removeChild(e.backdrop),e.container.style.display="none",t.construct&&e.container.parentNode.removeChild(e.container),this._visible=!1,this.emit("hidden",this)}),t.transition),this}_removeEvents(){this._events.keydownHandler&&document.body.removeEventListener("keydown",this._events.keydownHandler),this._html.container.removeEventListener("mousedown",this._events.mousedownHandler),this._html.container.removeEventListener("click",this._events.clickHandler),window.removeEventListener("resize",this._events.resizeHandler)}_checkScrollbar(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}_setScrollbar(){if(this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing){let e=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=e+this._scrollbarWidth+"px"}}}const p=b,C=(e,t)=>{const n=document.createElement("div"),s=new o(e).element;n.appendChild(s);const i=new p({content:n,footer:!0,buttons:[{text:"Отменить",value:!1,attr:{class:"btn","data-dismiss":"modal"}}],header:!1,backdrop:"static"}),a=e=>{t&&t(),e.off("hide",a)};return i.on("hide",a),i},v="startGame",f="findGame",y="createGame",w=class extends i{#t=null;#n=null;#s=null;constructor(){super()}showFindGameModal=e=>{this.findGameModal=C("Ищем игру...",e),this.findGameModal.show()};hideFindGameModal=()=>{this.findGameModal.hide()};handleClickStartBtn=e=>{e.preventDefault(),this.emit(v)};handleClickFindGameBtn=e=>{e.preventDefault(),this.emit(f)};handleClickCreateGameBtn=e=>{e.preventDefault(),this.emit(y)};bind(e){this.#t=e.querySelector(".js-btn-start"),this.#t.addEventListener("click",this.handleClickStartBtn),this.#n=e.querySelector(".js-find-game-btn"),this.#n.addEventListener("click",this.handleClickFindGameBtn),this.#s=e.querySelector(".js-reate-game-btn"),this.#s.addEventListener("click",this.handleClickCreateGameBtn)}unbind(){this.#t.removeEventListener("click",this.handleClickStartBtn),this.#n.removeEventListener("click",this.handleClickFindGameBtn),this.#s.removeEventListener("click",this.handleClickCreateGameBtn)}get template(){return'<article class="welcome-view">\n                <h1 class="welcome-view__title page-title">\n                    Крестики <span>X</span> Н<span>0</span>лики\n                </h1>\n                <div class="welcome-view__btn-play-wrap">\n                    <button class="btn js-btn-start"\n                        type="button">\n                        Играть\n                    </button>\n                </div>\n                <section class="welcome-view__game-modes">\n                    <h2 class="subtitle">Игра по сети</h2>\n                    <div class="welcome-view__game-modes-btns-wrap">\n                        <button class="js-find-game-btn btn"\n                            type="button">\n                            Найти игру\n                        </button>\n                        <button class="js-reate-game-btn btn btn--action"\n                            type="button">\n                            Создать игру\n                        </button>\n                    </div>\n                </section>\n            </article>'}},_="online",L="offline",T="FIND_GAME",M="ICE_CANDIDATE",S="USER",E="OFFER",k="ANSWER",O="SETTINGS",I="START",D="MOVE",G="RETRY",A="initiator",x="createGame=true",N="findGame=true",F="X",H="O",W='<svg x="0px" y="0px" \n            xmlns="http://www.w3.org/2000/svg"\n            height="25"\n            width="25"\n            fill="#b9258f"\n            viewBox="0 0 492 492">\n            <path d="M300.188,246L484.14,62.04c5.06-5.064,7.852-11.82,7.86-19.024c0-7.208-2.792-13.972-7.86-19.028L468.02,7.872\n                c-5.068-5.076-11.824-7.856-19.036-7.856c-7.2,0-13.956,2.78-19.024,7.856L246.008,191.82L62.048,7.872\n                c-5.06-5.076-11.82-7.856-19.028-7.856c-7.2,0-13.96,2.78-19.02,7.856L7.872,23.988c-10.496,10.496-10.496,27.568,0,38.052\n                L191.828,246L7.872,429.952c-5.064,5.072-7.852,11.828-7.852,19.032c0,7.204,2.788,13.96,7.852,19.028l16.124,16.116\n                c5.06,5.072,11.824,7.856,19.02,7.856c7.208,0,13.968-2.784,19.028-7.856l183.96-183.952l183.952,183.952\n                c5.068,5.072,11.824,7.856,19.024,7.856h0.008c7.204,0,13.96-2.784,19.028-7.856l16.12-16.116\n                c5.06-5.064,7.852-11.824,7.852-19.028c0-7.204-2.792-13.96-7.852-19.028L300.188,246z"/>\n        </svg>',B='<svg x="0px" y="0px"\n            xmlns="http://www.w3.org/2000/svg"\n            height="25"\n            width="25"\n            class="zero"\n            fill="#870eff"\n            viewBox="0 0 380.734 380.734">\n            <path d="M190.367,0C85.23,0,0,85.23,0,190.367s85.23,190.367,190.367,190.367s190.367-85.23,190.367-190.367\n                S295.504,0,190.367,0z M299.002,298.36c-28.996,28.996-67.57,44.959-108.634,44.959S110.723,327.35,81.733,298.36\n                c-28.865-28.876-44.769-67.227-44.769-107.993c0-40.771,15.904-79.128,44.769-107.993c28.99-28.996,67.57-44.959,108.634-44.959\n                c41.054,0,79.639,15.969,108.629,44.959c28.871,28.865,44.763,67.221,44.763,107.993\n                C343.765,231.133,327.867,269.489,299.002,298.36z"/>\n            </svg>',R={fieldSize:3,settingsFields:[{type:"input",label:"Выберите размер поля:",name:"numberCellsInRow",fieldType:"number",attrs:'min="3" max="15"',value:3}],gameMode:L},j={character:"X",fieldSize:3,settingsFields:[{type:"radio",label:"Выберите символ:",items:[{name:"playerCharacter",value:F,selected:!0,icon:W,class:"x"},{name:"playerCharacter",value:H,selected:!1,icon:B,class:"zero"}],name:"playerCharacter",value:"X"},{type:"input",label:"Выберите размер поля:",name:"numberCellsInRow",fieldType:"number",attrs:'min="3" max="15"',value:3}],gameMode:_},P=(e,t)=>({type:e,payload:{...t}}),z={OPEN:"open",CLOSE:"close",MESSAGE:"message",ERROR:"error"},V=class extends t{constructor(){super()}create(e){this.socket=new WebSocket(e),this.socket.onopen=this.onOpen,this.socket.onmessage=this.onMessage,this.socket.onclose=this.onClose,this.socket.onerror=this.onError}close(e){this.socket.close(),this.emit(z.CLOSE,e)}send(e){this.socket.send(JSON.stringify(e))}onOpen=e=>{this.emit(z.OPEN,e)};onMessage=e=>{const t=JSON.parse(e.data);this.emit(z.MESSAGE,t)};onClose=e=>{this.emit(z.CLOSE,e)};onError=e=>{this.emit(z.ERROR,e)}},$={DATA_CHANNEL:"dataChannel",CONNECTION_STATE_CHANGE:"connectionStateChange",ICE_CANDIDATE:"iceCandidate",ICE_CONNECTION_STATE_CHANGE:"iceConnectionStateChange",OPEN_DATA_CHANNEL:"openDataChannel",MESSAGE_DATA_CHANNEL:"messageDataChannel",CLOSE_DATA_CHANNEL:"closeDataChannel"};let q;const X=new Promise((e=>{q=e})),Y=class extends t{#i=null;#o=[];#a=null;#r=null;#l=null;#c=null;constructor(e,t,n="gomoku"){super(),this.nameDataChannel=n,this.isInitiator=t,this.socket=e,this.socket.subscribe(z.MESSAGE,this.onSocketMessage)}get dataChannel(){return this.#i}get initiatorId(){return this.#r}set initiatorId(e){this.#r=e}get recipientId(){return this.#l}set recipientId(e){this.#l=e}create(){this.#a=new RTCPeerConnection,this.#a.addEventListener("datachannel",this.onDataChannel),this.#a.addEventListener("connectionstatechange",this.onConnectionStateChange),this.#a.addEventListener("icecandidate",this.onIceCandidate),this.#a.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange)}close(){"connected"===this.#a.connectionState&&this.#a.close()}addIceCandidate(e){this.#a.addIceCandidate(e)}onDataChannel=e=>{this.#i=e.channel,this.#i.onopen=this.onOpenDataChannel,this.#i.onclose=this.onCloseDataChannel,this.#i.onmessage=this.onMessageDataChannel,this.emit($.DATA_CHANNEL,e)};onOpenDataChannel=()=>{this.clearConnectionTimeout(),this.emit($.OPEN_DATA_CHANNEL)};onCloseDataChannel=()=>{this.emit($.CLOSE_DATA_CHANNEL)};onMessageDataChannel=e=>{try{const t=JSON.parse(e.data);this.emit($.MESSAGE_DATA_CHANNEL,t)}catch(e){throw new Error(e)}};sendData(e){try{const t=JSON.stringify(e);this.#i.send(t)}catch(e){throw new Error(e)}}createDataChannel(e){this.#i=this.#a.createDataChannel(e),this.#i.onopen=this.onOpenDataChannel,this.#i.onclose=this.onCloseDataChannel,this.#i.onmessage=this.onMessageDataChannel}async createOffer(){this.createDataChannel(this.nameDataChannel);const e=await this.#a.createOffer();return await this.#a.setLocalDescription(e),e}async createAnswer(){const e=await this.#a.createAnswer();return await this.#a.setLocalDescription(e),e}onConnectionStateChange=()=>{"connected"===this.#a.connectionState&&this.socket.close(),this.emit($.CONNECTION_STATE_CHANGE,this.#a.connectionState)};onIceConnectionStateChange=()=>{this.emit($.ICE_CONNECTION_STATE_CHANGE,this.#a.iceConnectionState)};onIceCandidate=e=>{e.candidate?this.#o.push(e.candidate):(this.clearConnectionTimeout(),q()),this.emit($.ICE_CANDIDATE,e.candidate)};sendIceCandidates(){const e=P(M,{clientId:this.isInitiator?this.recipientId:this.initiatorId,iceCandidateList:this.#o});this.socket.send(e)}async acceptRemoteOffer(e){return await this.#a.setRemoteDescription(e)}async acceptAnswer(e){return await this.#a.setRemoteDescription(e)}onSocketMessage=async e=>{switch(e.type){case S:{const t=e.payload.clientId;if(this.isInitiator){this.initiatorId=t;const e=await this.createOffer(),n=P(E,{offer:e,initiatorId:this.initiatorId});this.socket.send(n),this.setConnectionTimeout()}else{this.recipientId=t;const e=P(T);this.socket.send(e),this.setConnectionTimeout()}}break;case M:this.clearConnectionTimeout(),e.payload.iceCandidateList.forEach((e=>{this.addIceCandidate(e)}));break;case E:this.initiatorId=e.payload.initiatorId,this.acceptRemoteOffer(e.payload.offer).then((()=>{this.createAnswer().then((e=>{const t=P(k,{initiatorId:this.initiatorId,recipientId:this.recipientId,answer:e});this.socket.send(t),this.setConnectionTimeout()}))}));break;case k:this.recipientId=e.payload.recipientId,console.log("send answer"),this.acceptAnswer(e.payload.answer).then((()=>{X.then((()=>{this.clearConnectionTimeout(),this.setConnectionTimeout(),this.sendIceCandidates()}))}))}};setConnectionTimeout=()=>{null==this.#c&&(this.#c=setTimeout((()=>{this.socket.close(!1)}),1e4))};clearConnectionTimeout=()=>{this.#c&&(clearTimeout(this.#c),this.#c=null)}};class K{#a=null;#h=null;constructor(e=!1,t=N){this.#h=new V,this.#a=new Y(this.#h,e),this.socketParams=t}get peerConnection(){return this.#a}get peerConnectorEvents(){return $}get webSocketEvents(){return z}sendMessage(e){this.#a.sendData(e)}subscribeMessageServer(e,t){return this.#a.subscribe(e,t)}subscribeServer(e,t){return this.#a.subscribe(e,t)}createConnection(){this.peerConnection.create(),this.#h.create(`ws://192.168.1.49:9000/?${this.socketParams}`)}closeConnect(){this.#h.close(),this.#a.close()}}const U=e=>e===_?j:R,J=e=>e===H?B:W,Q="saveSettings",Z="back",ee=class extends i{#d=null;#m=null;constructor(e){super(),this.settings=e,this.onSaveSettings=this.onSaveSettings.bind(this)}showCreateGameModal=e=>{this.createGameModal=C("Ищем игру...",e),this.createGameModal.show()};hideCreateGameModal=()=>{this.createGameModal.hide()};onSaveSettings(e){e.preventDefault();const t=e.submitter.classList.contains("js-start-game-online-btn")?_:L,n=new FormData(this.#d);this.emit(Q,{formData:n,gameMode:t})}bind(e){this.#d=e.querySelector(".js-settings-form"),this.#d.addEventListener("submit",this.onSaveSettings),this.#m=e.querySelector(".js-back-btn"),this.#m.addEventListener("click",this.onBackBtnHandler)}unbind(){this.#d.removeEventListener("submit",this.onSaveSettings),this.#m.removeEventListener("click",this.onBackBtnHandler)}onBackBtnHandler=e=>{e.preventDefault(),this.emit(Z)};renderFormFields(e){return e.map(((e,t)=>"radio"===e.type?`<section class="settings-block">\n                    <h2 class="subtitle settings-block__title">\n                        ${e.label}\n                    </h2>\n                    <div class="character">\n                        ${((e,t)=>e.map(((e,n)=>`<input type="radio"\n                            id="${e.value}"\n                            data-index-form-control="${t}"\n                            data-index="${n}"\n                            name="${e.name}"\n                            class="character__input"\n                            value="${e.value}"\n                            ${e.selected?"checked":""}>\n                <label class="character__${e.class}"\n                    for="${e.value}">\n                    ${e.icon}\n                </label>`)).join(""))(e.items,t)}\n                    </div>\n                </section>`:"input"===e.type?`<section class="settings-block">\n                    <h2 class="subtitle settings-block__title">\n                        ${e.label}\n                    </h2>\n                    <div class="settings-block__input-wrap">\n                        <label class="settings-block__label">\n                            <span class="input-wrap">\n                                <input name="${e.name}"\n                                    data-index-form-control="${t}"\n                                    value="${e.value}"\n                                    ${e.attrs?e.attrs:""}\n                                    type="${e.fieldType}">\n                            </span>\n                        </label>\n                    </div>\n                </section>`:void 0)).join("")}renderBtn(e){const t=e===_;return`\n            <button class="btn${t?" js-start-game-online-btn":""} settings-view__start-btn">\n                ${t?"Создать":"Играть"}\n            </button>\n        `}get template(){return`<article class="settings-view">\n                <h1 class="settings-view__title page-title">\n                    Настройки\n                </h1>\n                <div class="settings-view__back">\n                    <button class="settings-view__back-btn js-back-btn btn-back" type="button">Назад</button>\n                </div>\n                \n                <form name="settings-form" class="settings-view__form js-settings-form">\n                    ${this.renderFormFields(this.settings.settingsFields).trim()}\n                    <section class="settings-view__start-block">\n                        <h2 class="" hidden>Начать игру</h2>\n                        ${this.renderBtn(this.settings.gameMode)}\n                    <section>\n                </form>\n            </article>`}},te="clickGameField",ne="retry",se="clickToMain",ie=class extends i{#u=null;#g=null;#b=new Map;#p=null;#C=null;constructor(e){super(),this.cellHeight=e.cellHeight,this.cellWidth=e.cellWidth,this.lineWidth=e.lineWidth,this.widthField=e.sizeField.width,this.heightField=e.sizeField.height,this.numbersLines=e.numbersLines}handleClickCanvas=e=>{e.preventDefault(),this.emit(te,e)};handleRetry=e=>{e.preventDefault(),this.emit(ne,e)};handleBackToMain=e=>{e.preventDefault(),this.emit(se,e)};changeMoveStatusText=e=>{null==this.moveStatusEl&&(this.moveStatusEl=this.element.querySelector(".js-move-status")),this.moveStatusEl.textContent=e};bind(e){this.#u=e.querySelector("#gameCanvas"),this.#g=e.querySelector(".js-retry-btn"),this.#C=e.querySelector(".js-back-to-main-btn"),this.#u.addEventListener("click",this.handleClickCanvas),this.#g.addEventListener("click",this.handleRetry),this.#C.addEventListener("click",this.handleBackToMain)}unbind(){this.#u.removeEventListener("click",this.handleClickCanvas),this.#g.removeEventListener("click",this.handleRetry),this.#C.removeEventListener("click",this.handleBackToMain)}get template(){return'\n            <article class="game-view">\n                <h1 class="page-title">Игра</h1>\n                <div class="game-view__back-to-main">\n                    <button class="game-view__back-to-main-btn js-back-to-main-btn btn-back" type="button">Выйти на главную</button>\n                </div>\n                <button type="button" class="btn game-view__retry-btn js-retry-btn" hidden>Заново</button>\n                <h2 class="game-view__move-status js-move-status"></h2>\n                <canvas id="gameCanvas"></canvas>\n            </article>\n        '}drawGameField(){const e=this.#p;e.beginPath(),e.strokeStyle="blue",new Array(this.numbersLines).fill(null).forEach(((t,n)=>{let s=n*this.lineWidth+this.lineWidth/2+this.cellWidth*n;e.moveTo(0,s),e.lineTo(this.widthField,s),s=n*this.lineWidth+this.lineWidth/2+this.cellHeight*n,e.moveTo(s,0),e.lineTo(s,this.heightField)})),e.stroke(),e.closePath()}async renderImage(e){const t=this.#b.get(e);if(!t){const t=await(async e=>{const t=J(e);return await(n=t,new Promise((e=>{const t=new Image,s=new Blob([n],{type:"image/svg+xml"});t.src=URL.createObjectURL(s),t.onload=()=>{e(t)}})));var n})(e);return this.#b.set(e,t),t}return t}async drawImgInCell(e,t,n,s){const i=await this.renderImage(t),o=this.#p,a=e.coords[0],r=e.coords[1];let l=a[0],c=r[0];n<this.cellWidth&&(l+=Math.ceil((this.cellWidth-n)/2)),s<this.cellHeight&&(c+=Math.ceil((this.cellHeight-s)/2)),o.drawImage(i,l,c,n,s)}renderWinLine(e){const t=this.#p;t.lineWidth=4;const{startX1Coords:n,startX2Coords:s,endY1Coords:i,endY2Coords:o}=e;t.beginPath(),t.strokeStyle="rgba(197, 197 , 3, .8)",t.moveTo(n,i),t.lineTo(s,o),t.stroke(),t.closePath()}showRetryBtn(){this.#g.removeAttribute("hidden")}postRender(){this.#u.setAttribute("width",this.widthField),this.#u.setAttribute("height",this.heightField),this.#p=this.#u.getContext("2d"),this.#p.lineWidth=this.lineWidth,this.drawGameField()}},oe=e=>{document.body.innerHTML="",document.body.appendChild(e)},ae=class{static showWelcome(){const e=new class{#v=null;#f=null;constructor(){this.#f={[O]:this.#y.bind(this),[I]:this.#w.bind(this)},this.welcomeView=new w,this.welcomeView.subscribe(v,this.startOfflineGame),this.welcomeView.subscribe(f,this.findOnlineGame),this.welcomeView.subscribe(y,this.createOnlineGame)}get element(){return this.welcomeView.element}onMessageDataChannel=e=>{this.#f[e.type](e.payload)};#y(e){this.gameSettings=Object.assign({},e.gameSettings),this.gameSettings.player1Character=e.gameSettings.player2Character,this.gameSettings.player2Character=e.gameSettings.player1Character,this.gameSettings.isMyMove=this.gameSettings.player1Character===F,this.#v.sendMessage(P(I))}#w(){this.unsubscribeMessageDataChannel(),this.welcomeView.unbind(),ae.showGame(this.gameSettings,this.#v)}startOfflineGame=()=>{ae.showGameSettings(L)};createConnection=()=>{this.#v=new K(!1,N,null,this.onCloseSocket,this.onMessageDataChannel),this.unsubscribeWebsocketClose=this.#v.subscribeServer(this.#v.webSocketEvents.CLOSE,this.onCloseSocket),this.unsubscribeMessageDataChannel=this.#v.subscribeMessageServer(this.#v.peerConnectorEvents.MESSAGE_DATA_CHANNEL,this.onMessageDataChannel),this.#v.createConnection()};findOnlineGame=()=>{this.welcomeView.showFindGameModal(this.closeConnect),this.createConnection()};createOnlineGame=()=>{this.welcomeView.unbind(),ae.showGameSettings(_)};closeConnect=()=>{this.#v.closeConnect(),this.unsubscribeMessageDataChannel()};onCloseSocket=e=>{if(!1===e){const e=p.alert("Не удалось подключиться").show();this.unsubscribeWebsocketClose(),this.closeConnect(),e.on("hide",(()=>{this.welcomeView.hideFindGameModal()}))}}};oe(e.element)}static showGameSettings(e){const t=new class{#v=null;#f=null;constructor(e){this.#f={[I]:this.#w.bind(this)};const t=U(e);this.settingsView=new ee(t),this.unsubscribeOnSaveSettings=this.settingsView.subscribe(Q,this.saveSettings),this.unsubscribeOnBackBtn=this.settingsView.subscribe(Z,this.backToView)}get element(){return this.settingsView.element}#w=()=>{this.showGame(),this.unsubscribeMessageDataChannel()};onMessageDataChannel=e=>{this.#f[e.type](e.payload)};onOpenDataChannel=()=>{const e=P(O,{gameSettings:this.gameSettings});this.#v.sendMessage(e)};saveSettings=e=>{const t=Object.freeze((e=>{const t={};for(let[n,s]of e)t[n]=s;return t})(e.formData)),n=e.gameMode===_,s=Number(t.numberCellsInRow),i=Number(t.numberCellsInRow)+1,o=s>7?5:3;this.gameSettings={numberCellsInRow:s,numbersLines:i,sizeTemplateForWin:o,gameMode:e.gameMode,isMyMove:!0},n?(this.gameSettings={...this.gameSettings,player1Character:t.playerCharacter,player2Character:t.playerCharacter===F?H:F,playerType:A,isMyMove:t.playerCharacter===F},this.createConnect()):(this.gameSettings={...this.gameSettings,player1Character:F,player2Character:H},this.showGame())};createConnect=()=>{this.#v=new K(!0,x,this.onMessageDataChannel),this.unsubscribeOpenDataChannel=this.#v.subscribeMessageServer(this.#v.peerConnectorEvents.OPEN_DATA_CHANNEL,this.onOpenDataChannel),this.unsubscribeWebsocketClose=this.#v.subscribeServer(this.#v.webSocketEvents.CLOSE,this.onCloseSocket),this.unsubscribeMessageDataChannel=this.#v.subscribeMessageServer(this.#v.peerConnectorEvents.MESSAGE_DATA_CHANNEL,this.onMessageDataChannel),this.#v.createConnection(),this.settingsView.showCreateGameModal(this.closeConnect)};closeConnect=()=>{this.#v.closeConnect(),this.unsubscribeWebsocketClose(),this.unsubscribeMessageDataChannel(),this.unsubscribeOpenDataChannel()};showGame=()=>{this.destroyListeners(),ae.showGame(this.gameSettings,this.#v)};onCloseSocket=e=>{!1===e&&(p.alert("Не удалось подключиться").show().on("hide",(()=>{this.settingsView.hideCreateGameModal()})),this.closeConnect())};destroyListeners=()=>{this.unsubscribeOnBackBtn(),this.unsubscribeOnSaveSettings(),this.settingsView.unbind()};backToView=()=>{this.destroyListeners(),ae.showWelcome()}}(e);oe(t.element)}static showGame(e,t){new class{#v=null;constructor(e,t,n){this.onStartCallback=t,this.gameSettings=e,this.#v=n||null,this.startGame()}get element(){return this.gameView.element}onClickGameField=async e=>{if(this.gameModel.isFreeze||this.gameModel.gameStatus===this.gameModel.gameStatuses.END)return;const t={x:e.offsetX,y:e.offsetY},n=this.gameModel.getCellByCoord(t);n&&n.isEmpty&&await this.move(n,this.gameModel.isOnlineMode)};move=async(e,t=!1)=>{if(this.gameModel.isFreeze&&t)return;const n=this.gameModel.currentPlayer;if(await this.gameView.drawImgInCell(e,n,this.gameModel.imageWidth-15,this.gameModel.imageHeight-15),this.gameModel.changeStateCell(e),this.gameModel.isOnlineMode&&t){const t=P(D,{cell:e});this.#v.sendMessage(t)}const s=this.gameModel.checkWin(e);let i=null;s.gameStatus!==this.gameModel.gameStatuses.GAME&&(i="Ничья",s.gameStatus===this.gameModel.gameStatuses.PLAYER_WIN&&(this.gameView.renderWinLine(this.getWinLineCoords(s)),i=`Победили ${this.gameModel.currentPlayer}`),this.gameModel.gameStatus=this.gameModel.gameStatuses.END,this.gameView.showRetryBtn()),this.gameModel.changePlayer(),this.gameView.changeMoveStatusText(i??this.gameModel.gameStatusText)};getWinLineCoords=({direction:e,winCellsList:t})=>{const n=this.gameModel.winDirections,s=t.shift(),i=t.pop(),o=this.gameModel.cellHeight/2;return{[n.LEFT_TO_RIGHT]:()=>({startX1Coords:s.coords[0][0],endY1Coords:s.coords[1][1]-o,startX2Coords:i.coords[0][1],endY2Coords:i.coords[1][1]-o}),[n.TOP_TO_BOTTOM]:()=>({startX1Coords:s.coords[0][0]+o,endY1Coords:s.coords[1][0],startX2Coords:i.coords[0][0]+o,endY2Coords:i.coords[1][1]}),[n.RIGHT_TOP_TO_LEFT_BOTTOM]:()=>({startX1Coords:s.coords[0][0],endY1Coords:s.coords[1][1],startX2Coords:i.coords[0][1],endY2Coords:i.coords[1][0]}),[n.LEFT_TOP_TO_RIGHT_BOTTOM]:()=>({startX1Coords:s.coords[0][0],endY1Coords:s.coords[1][0],startX2Coords:i.coords[0][1],endY2Coords:i.coords[1][1]})}[e]?.()};onMessageDataChannel=async e=>{switch(e.type){case D:await this.move(e.payload.cell,!1);break;case G:this.unsubscribeDataChannel(),this.startGame()}};onCloseDataChannel=()=>{this.unsubscribeMessageDataChannel(),this.unsubscribeCloseDataChannel(),this.#v=null,p.alert("Ваш проивник вышел!",{buttons:[{text:"На главную",value:!1,attr:{class:"btn","data-dismiss":"modal"}}]}).show().on("hidden",(()=>{ae.showWelcome()}))};retryGame=()=>{if(this.gameModel.isOnlineMode){const e=P(G);this.#v.sendMessage(e),this.unsubscribeDataChannel()}this.destroyListeners(),this.startGame()};backToMainPage=()=>{this.gameModel.isOnlineMode&&(this.unsubscribeDataChannel(),this.#v.closeConnect()),this.destroyListeners(),ae.showWelcome()};unsubscribeDataChannel(){this.unsubscribeMessageDataChannel(),this.unsubscribeCloseDataChannel()}destroyListeners(){this.unsubscribeClickGameField(),this.unsubscribeBackToMain(),this.unsubscribeRetry(),this.gameView.unbind()}startGame(){this.gameModel=new class{#_=null;#L=null;#T=null;#M=null;#S=50;#E=50;#k=2;#O=null;#I=null;#D=[];#G=null;#A={PLAYER_WIN:"playerWin",GAME:"game",END:"end"};#x=this.#A.GAME;constructor(e){this.#_=e.numbersLines,this.#L=e.numberCellsInRow,this.#G=this.#L**2,this.player1Character=e.player1Character,this.player2Character=e.player2Character,this.#O=e.isMyMove,this.#T=this.coordsCells,this.#I=e.sizeTemplateForWin,this.gameMode=e.gameMode}get winDirections(){return{LEFT_TO_RIGHT:"leftToRight",TOP_TO_BOTTOM:"topToBottom",LEFT_TOP_TO_RIGHT_BOTTOM:"leftTopToRightBottom",RIGHT_TOP_TO_LEFT_BOTTOM:"rightTopToLeftBottom"}}get gameStatuses(){return this.#A}get gameStatus(){return this.#x}set gameStatus(e){this.#x=e}get isOnlineMode(){return this.gameMode===_}get isFreeze(){return this.isOnlineMode&&!this.isMyMove}get cellWidth(){return this.#S}get cellHeight(){return this.#E}get imageWidth(){return this.#S}get imageHeight(){return this.#E}get isMyMove(){return this.#O}changePlayer(){this.#O=!this.#O}get gameStatusText(){return this.#O?"Ваш ход":"Ход соперника"}get coordsCells(){if(this.#T)return this.#T;const e=new Array(this.#L**2).fill(null),{cellsCoordsList:t}=e.reduce(((e,t,n)=>{let s;const i=this.#L;let{startX:o,startY:a,cellsCoordsList:r}=e;o+=this.#k;const l=o+this.#S,c=[o,l];a+=this.#k;const h=a+this.#E,d=[a,h],m=n%i?e.rowIndex:++e.rowIndex,u=n%i?++e.colIndex:1;return n%i?s=e.cellsCoordsList[m-1]:(s=[],r.push(s)),s.push({index:u-1,isEmpty:!0,coords:[c,d],rowIndex:m,colIndex:u,i:n}),{startX:(n+1)%i?l:0,startY:(n+1)%i?a-this.#k:h,cellsCoordsList:r,rowIndex:m,colIndex:u}}),{startX:0,startY:0,colIndex:0,rowIndex:0,cellsCoordsList:[]});return t}get sizeGameField(){return this.#M?this.#M:{width:this.#S*this.#L+this.#k*this.#_,height:this.#E*this.#L+this.#k*this.#_}}get gameFieldSettings(){return{cellHeight:this.#E,cellWidth:this.#S,lineWidth:this.#k,numbersLines:this.#_,sizeField:this.sizeGameField}}get isDeadHeat(){return this.#D.length===this.#G}get currentPlayer(){return this.isMyMove?this.player1Character:this.player2Character}changeStateCell(e){const t=this.#T[e.rowIndex-1][e.index];t.symbol=this.currentPlayer,t.isEmpty=!1}getCellByCoord(e){let t=null;for(let n of this.coordsCells){const s=n.find((t=>{const n=t.coords,s=n[0],i=n[1],o=s[0],a=s[1],r=i[0],l=i[1];return o<e.x&&a>e.x&&r<e.y&&l>e.y}));if(s){t=s;break}}return t}checkCellsForWinList(e,t,n,s){null!=e&&(0===t.length||e===n.symbol?t.push(s):t.length=0)}checkHorizontalLine(e,t,n,s,i){let o=[],a=null,r="";for(let s=e;s<=t;s++){const e=n[s],t=e.symbol;this.checkCellsForWinList(t,o,a,e),a=e,r+=t??"_"}return{isWin:-1!==r.indexOf(s),winCellsList:o,direction:i}}checkVerticalLine(e,t,n,s,i,o){let a=[],r=null,l="";for(let n=e;n<=t;n++){const e=this.coordsCells[n][i],t=e.symbol;this.checkCellsForWinList(t,a,r,e),r=e,l+=t??"_"}return{isWin:-1!==l.indexOf(s),winCellsList:a,direction:o}}checkLeftToRightDiagonal(e,t,n,s){let i=[],o=null,a="";const{leftLimit:r,topLimit:l,rightLimit:c,bottomLimit:h}=e;for(let e=r,t=l;e<=c||t<=h;e++,t++){const s=n[t][e],r=s.symbol;this.checkCellsForWinList(r,i,o,s),o=s,a+=s.symbol??"_"}return{isWin:-1!==a.indexOf(t),winCellsList:i,direction:s}}checkRightToLeftDiagonal(e,t,n,s){let i=[],o=null,a="";const{leftLimit:r,topLimit:l,rightLimit:c,bottomLimit:h}=e;for(let e=r,t=h;e<=c||t>=l;e++,t--){const s=n[t][e],r=s.symbol;this.checkCellsForWinList(r,i,o,s),o=s,a+=s.symbol??"_"}return{isWin:-1!==a.indexOf(t),winCellsList:i,direction:s}}checkWin(e){this.#D.push(e);const t=this.#I-1,n=e.colIndex-1,s=e.rowIndex-1,i=this.coordsCells[s],o=this.coordsCells.length-1,a=this.currentPlayer.repeat(this.#I);let r=n-t,l=s-t,c=s+t,h=n+t,d=r<0?0:r,m=h>o?o:h,u=l<0?0:l,g=c>o?o:c,b=null;for(let e of Object.values(this.winDirections)){if(null!=b&&b.isWin)break;switch(e){case this.winDirections.LEFT_TO_RIGHT:b=this.checkHorizontalLine(d,m,i,a,this.winDirections.LEFT_TO_RIGHT);break;case this.winDirections.TOP_TO_BOTTOM:b=this.checkVerticalLine(u,g,i,a,n,this.winDirections.TOP_TO_BOTTOM);break;case this.winDirections.LEFT_TOP_TO_RIGHT_BOTTOM:{l=Math.abs(0-s),r=Math.abs(0-n),c=Math.abs(o-s),h=Math.abs(o-n);const e=Math.min(l,r,t),i=Math.min(c,h,t);u=s-e,g=s+i,d=n-e,m=n+i;let p={topLimit:u,bottomLimit:g,leftLimit:d,rightLimit:m};b=this.checkLeftToRightDiagonal(p,a,this.coordsCells,this.winDirections.LEFT_TOP_TO_RIGHT_BOTTOM)}break;case this.winDirections.RIGHT_TOP_TO_LEFT_BOTTOM:{const e=Math.min(l,h,t),i=Math.min(c,r,t);u=s-e,g=s+i,d=n-i,m=n+e;const o={topLimit:u,bottomLimit:g,leftLimit:d,rightLimit:m};b=this.checkRightToLeftDiagonal(o,a,this.coordsCells,this.winDirections.RIGHT_TOP_TO_LEFT_BOTTOM)}}}return null!=b&&b.isWin?(b.gameStatus=this.#A.PLAYER_WIN,b):this.isDeadHeat?{gameStatus:this.#A.END}:{gameStatus:this.#A.GAME}}}(this.gameSettings),this.gameView=new ie(this.gameModel.gameFieldSettings),this.gameModel.isOnlineMode&&(this.unsubscribeMessageDataChannel=this.#v.subscribeMessageServer($.MESSAGE_DATA_CHANNEL,this.onMessageDataChannel),this.unsubscribeCloseDataChannel=this.#v.subscribeMessageServer($.CLOSE_DATA_CHANNEL,this.onCloseDataChannel),this.#v.sendMessage(P(I))),this.unsubscribeClickGameField=this.gameView.subscribe(te,this.onClickGameField),this.unsubscribeRetry=this.gameView.subscribe(ne,this.retryGame),this.unsubscribeBackToMain=this.gameView.subscribe(se,this.backToMainPage),this.gameView.changeMoveStatusText(this.gameModel.gameStatusText),this.onStartCallback(this.element)}}(e,oe,t)}};window.addEventListener("load",(()=>{ae.showWelcome()}))})()})();
//# sourceMappingURL=bundle.js.map